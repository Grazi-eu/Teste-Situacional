<script>
/* --- CONFIGURAÇÃO --- */
const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbzE4IiI2fI5VCEY3nJOo622snscHzQ1h7rD81ZBy99yGFyUCp-5FAXDhaUr2QflPTqjWQ/exec';
const SECRET_KEY = 'Grazi123'; // chave secreta, precisa bater com a do Apps Script

/* --- FORMULÁRIO --- */
document.getElementById('submitBtn').addEventListener('click', async () => {
  const name = document.getElementById('participantName').value.trim();
  if (!name) { alert('Por favor insira o nome completo do participante.'); return; }

  const answers = [];
  const counts = { D:0, I:0, S:0, C:0 };

  for (let i = 1; i <= questions.length; i++) {
    const selected = document.querySelector(`input[name=q${i}]:checked`);
    if (!selected) { alert('Por favor responda todas as perguntas. Falta a pergunta ' + i + '.'); return; }
    answers.push(selected.value);
    counts[selected.value] = (counts[selected.value] || 0) + 1;
  }

  const order = Object.entries(counts).sort((a,b) => b[1] - a[1]);
  const dominant = order[0][0];
  const secondary = order[1][0];
  
  const temperament = temperamentMap(dominant, secondary);

  const payload = {
    secret: SECRET_KEY,
    timestamp: new Date().toISOString(),
    name: name,
    counts: counts,
    dominant: dominant,
    secondary: secondary,
    temperament: temperament,
    answers: answers
  };

  try {
    const response = await fetch(WEBAPP_URL, {
      method: 'POST',
      mode: 'cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if (!response.ok) throw new Error('Erro ao enviar (status ' + response.status + ')');

    document.getElementById('discForm').reset();
    updateProgress();
    document.getElementById('thanks').style.display = 'block';
    window.scrollTo(0,0);

  } catch (err) {
    console.error(err);
    alert('Ocorreu um erro ao enviar. Verifique a conexão ou a configuração do Web App.');
  }
});

function temperamentMap(d, s) {
  const mapSingle = { D:'Colérico', I:'Sanguíneo', S:'Fleumático', C:'Melancólico' };
  const combos = {
    'CD':'Colérico-Melancólico',
    'CI':'Melancólico-Sanguíneo',
    'CS':'Melancólico-Fleumático',
    'DI':'Colérico-Sanguíneo',
    'DS':'Colérico-Fleumático',
    'IS':'Sanguíneo-Fleumático'
  };
  const key = [d, s].sort().join('');
  return combos[key] || mapSingle[d] || '';
}
</script>
